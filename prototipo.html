<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Meta Quest Button Tracker</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- Camera -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity camera look-controls>
          <a-entity id="logText"
                    text="value: Premi un pulsante sul controller; color: white; align: center"
                    position="0 0 -2"
                    geometry="primitive: plane; height: 0.5; width: 2"
                    material="color: black; opacity: 0.7">
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Sky -->
      <a-sky color="#222"></a-sky>

      <!-- Luce -->
      <a-entity light="type: ambient; color: #FFF"></a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent('button-logger', {
        init: function () {
          this.textEl = document.getElementById('logText');
          this.lastPressed = {};
        },
        tick: function () {
          const gamepads = navigator.getGamepads();
          if (!gamepads) return;

          for (let i = 0; i < gamepads.length; i++) {
            const gp = gamepads[i];
            if (gp && gp.buttons) {
              for (let b = 0; b < gp.buttons.length; b++) {
                const pressed = gp.buttons[b].pressed;
                const key = `${i}-${b}`;
                if (pressed && !this.lastPressed[key]) {
                  this.textEl.setAttribute('text', 'value', `Controller ${i} - Pulsante ${b} premuto`);
                }
                this.lastPressed[key] = pressed;
              }
            }
          }
        }
      });

      document.querySelector('a-scene').setAttribute('button-logger', '');
    </script>
  </body>
</html>
